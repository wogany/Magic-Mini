# Magic-Mini RGB控制器

基于ESP32-C3-WROOM-02模组的智能RGB LED矩阵控制器，支持实时颜色调节和无线配网功能。

## ? 项目概述

Magic-Mini是一个紧凑型RGB LED控制设备，采用5×8 LED矩阵布局，共40颗可编程LED灯珠。设备支持三按键操作，可实现精确的RGB颜色调节，并具备配网功能用于远程控制。

## ? 硬件规格

- **主控芯片**: ESP32-C3-WROOM-02 (4MB Flash)
- **LED规格**: WS2812B × 40颗 (5行8列矩阵)
- **按键配置**: 3个物理按键（左/中/右）
- **存储方案**: NVS持久化存储 + SPIFFS文件系统
- **连接方式**: Wi-Fi + OTA无线升级

## ? 操作说明

### 按键功能

| 按键位置 | 短按功能 | 长按功能 |
|---------|---------|---------|
| **左按键** | - | ? 减少当前颜色分量值 |
| **中按键** | ? 切换颜色分量 (R→G→B→R) | ? 长按10秒进入配网模式 |
| **右按键** | - | ? 增加当前颜色分量值 |

### 颜色调节流程

1. **选择颜色通道**：短按中间按键切换颜色分量
   - ? 红色分量 (Red: 0-255)
   - ? 绿色分量 (Green: 0-255) 
   - ? 蓝色分量 (Blue: 0-255)

2. **调节色值**：
   - 长按左按键：当前分量值递减 (最小值：0)
   - 长按右按键：当前分量值递增 (最大值：255)

3. **实时预览**：调节过程中LED矩阵实时显示颜色变化

4. **自动保存**：颜色值变化后自动保存至NVS存储器

### 配网模式

1. **进入方式**：长按中间按键10秒
2. **指示状态**：LED矩阵显示配网指示灯效
3. **连接步骤**：
   - 手机连接设备热点
   - 在配置页面输入Wi-Fi信息
   - 设备自动连接并退出配网模式

## ? 存储机制

### NVS存储 (推荐用于配置)
- **用途**：RGB颜色值、设备设置
- **优势**：快速读写、自动磨损均衡
- **存储内容**：
  ```cpp
  colorRed    : uint8_t  // 红色分量 (0-255)
  colorGreen  : uint8_t  // 绿色分量 (0-255)
  colorBlue   : uint8_t  // 蓝色分量 (0-255)
  brightness  : uint8_t  // 亮度设置
  autoSave    : bool     // 自动保存开关
  ```

### SPIFFS文件系统 (用于复杂数据)
- **用途**：预设方案、固件日志、用户自定义图案
- **容量**：960KB可用空间
- **特性**：OTA升级后数据保持不变

## ? 功能特性

- ? **实时颜色调节**：支持RGB三通道独立调节
- ? **持久化存储**：断电后保持上次设置
- ? **无线升级**：支持OTA固件更新
- ? **低功耗设计**：休眠模式降低功耗
- ? **磨损保护**：智能写入策略延长Flash寿命
- ? **即插即用**：上电自动恢复上次颜色设置

## ? 技术栈

- **开发框架**：Arduino for ESP32
- **构建工具**：PlatformIO
- **LED驱动**：Adafruit NeoPixel库
- **存储管理**：ESP32 Preferences库
- **网络功能**：ESP32 WiFi + ArduinoOTA

## ? OTA升级

设备支持无线固件更新，升级过程中：
- ? 用户设置(NVS数据)：**保持不变**
- ? 自定义文件(SPIFFS)：**保持不变**  
- ? 应用程序：**更新到新版本**

## ? 快速开始

1. **硬件连接**：按照引脚定义连接LED矩阵和按键
2. **编译上传**：使用PlatformIO编译并上传固件
3. **首次使用**：设备启动后显示默认白色
4. **调节颜色**：使用三按键调节到喜欢的颜色
5. **享受使用**：颜色设置自动保存，下次启动自动恢复
